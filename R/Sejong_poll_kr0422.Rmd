---
title: "King Sejong's National Poll on Tax Reform(Korean)"
author: "coop711"
date: "2015년 3월 29일"
output: html_document
---

Data Management
---------------

- 원자료는 세종실록, 요약표는 오기수 교수의 논문에서.

```{r}
load("sejong_poll_kr_2.rda")
str(sejong.poll.kr.2)
sejong.poll.kr.2
```

- 전체 찬반을 `xtabs()` 로 파악. `digits=3`의 역할에 유의

```{r}
options(digits=3)
xtabs(counts~vote, data=sejong.poll.kr.2)
prop.table(xtabs(counts~vote, data=sejong.poll.kr.2))
```

- `col=` 을 이용하여 색으로 찬반구분. 

```{r}
sejong.poll.kr.2$color[sejong.poll.kr.2$vote=="찬성"]<-"cyan"
sejong.poll.kr.2$color[sejong.poll.kr.2$vote=="반대"]<-"red"
```
- 윗 식을 한줄로 줄이려면 `ifelse()`를 이용하여

```{r}
color<-ifelse(sejong.poll.kr.2$vote=="찬성", "cyan", "red")
```


```{r fig.width=4, fig.height=4}
pie(xtabs(counts~vote, data=sejong.poll.kr.2), col=sejong.poll.kr.2$color)
title(main="전체 찬반")
text(x=0, y=c(0.4,-0.4), labels=c("98,657", "74,149"))
```

- 계급별 찬반.

```{r}
xtabs(counts~vote+class, data=sejong.poll.kr.2)
```

- 품관촌민의 수효가 상대적으로 많아서 별도로 분석.

```{r}
sejong.poll.kr.2$class.2<-ifelse(sejong.poll.kr.2$class=="품관촌민", "품관촌민", "관료")
```

- 관료와 품관촌민의 찬반 집계

```{r}
xtabs(counts~vote+class.2, data=sejong.poll.kr.2)
```

- 소계를 교차표의 주변에 계산.

```{r}
addmargins(xtabs(counts~vote+class.2, data=sejong.poll.kr.2))
```

- 비율을 계산하여 주변에 집계. 

```{r}
prop.table(xtabs(counts~vote+class.2, data=sejong.poll.kr.2), margin=2)
```

- 관료와 품관촌민의 찬반을 Pie chart에 도식화

```{r fig.width=8, fig.height=4}
attach(sejong.poll.kr.2)
par(mfrow=c(1,2))
pie(xtabs(counts~vote+class.2, data=sejong.poll.kr.2[class.2=="관료",], drop=T), labels=c("찬성", "반대"), col=color)
title(main="관료들의 찬반")
text(x=0, y=c(0.4,-0.4), labels=c("915", "845"))
pie(xtabs(counts~vote+class.2, data=sejong.poll.kr.2[class.2=="품관촌민",], drop=T), labels=c("찬성", "반대"), col=color)
title(main="품관촌민의 찬반")
text(x=0, y=c(0.4,-0.4), labels=c("97,742", "73,304"))
par(mfrow=c(1,1))
```

- 관료와 품관촌민의 찬반을 지역별로 집계.

```{r}
xtabs(counts~vote+region, data=sejong.poll.kr.2[class.2=="관료",], drop=T)
xtabs(counts~vote+region, data=sejong.poll.kr.2[class.2=="품관촌민",], drop=T)
```

- 서울은 다른 지역보다 월등히 많은 관료가 거주하므로 별도 집계.

```{r}
xtabs(counts~vote+class, data=sejong.poll.kr.2[region=="서울",], drop=T)
```


- 서울의 계급별 찬반을 barplot으로 그려봄. text()의 좌표는 locator()로 찾아냄.

```{r}
barplot(xtabs(counts~vote+class, data=sejong.poll.kr.2[region=="서울",], drop=T), col=color)
title(main="서울의 찬반")
text(x=c(0.7, 1.9, 1.9, 3.1, 3.1), y=c(120, 450, 135, 500, 220), labels=c("194","393", "259", "117", "443"))
legend("topleft", inset=0.05, fill=c("cyan", "red"), legend=c("찬성", "반대"))
```

- mosaicplot()의 활용.

```{r}
mosaicplot(xtabs(counts~class+vote, data=sejong.poll.kr.2[region=="서울",], drop=T), col=color, main="서울의 찬반", xlab="계급" , ylab ="찬반")
```

- 지역별 관료들의 찬반을 barplot()으로 그려봄.

```{r}
xtabs(counts~vote+region, data=sejong.poll.kr.2[class.2=="관료" & !region=="서울",], drop=T)
barplot(xtabs(counts~vote+region, data=sejong.poll.kr.2[class.2=="관료" & !region=="서울",], drop=T), col=color)
title(main="지방 관료들의 찬반")
legend("topleft", inset=0.05, fill=c("cyan", "red"), legend=c("찬성", "반대"))
```

- mosaicplot()의 활용

```{r}
mosaicplot(xtabs(counts~region+vote, data=sejong.poll.kr.2[class.2=="관료" & !region=="서울",], drop=T), col=color, main="", xlab="계급", ylab="찬반")
title(main="지방 관료들의 찬반")
```

- 품관촌민들의 지역별 찬반을 barplot()으로 요약.

```{r}
barplot(xtabs(counts~vote+region, data=sejong.poll.kr.2[class.2=="품관촌민",], drop=T), col=color)
title(main="품관촌민들의 지역별 찬반")
legend("topleft", inset=0.05, fill=c("cyan", "red"), legend=c("찬성", "반대"))
```

- mosaicplot()의 활용

```{r}
mosaicplot(xtabs(counts~region+vote, data=sejong.poll.kr.2[class.2=="품관촌민",], drop=T), col=color, main="품관촌민의 지역별 찬반", xlab="지역", ylab="찬반")
```

- 충청도는 관료들의 찬반과 품관촌민의 찬반이 다른 곳.

```{r}
xtabs(counts~vote+class, data=sejong.poll.kr.2[region=="충청",], drop=T)
prop.table(xtabs(counts~vote+class, data=sejong.poll.kr.2[region=="충청",], drop=T), margin=2)
barplot(prop.table(xtabs(counts~vote+class, data=sejong.poll.kr.2[region=="충청",], drop=T), margin=2), col=color, ylim=c(0, 1.5), axes=F)
axis(side=2, at=c(0, 0.5, 1.0), labels=c("0", "50%", "100%"))
title(main="충청도의 계급별 찬반 비율")
legend("topleft", inset=0.05, fill=c("cyan", "red"), legend=c("찬성", "반대"))
text(x=c(0.7, 1.9, 1.9, 3.1, 3.1), y=c(0.5, 0.3, 0.8, 0.15, 0.65), labels=c(2, 35, 26, 6982, 14013))
```

- mosaicplot()으로 수효의 차이가 너무 커서 비교하기 어려움.

```{r fig.width=12, fig.height=6}
mosaicplot(xtabs(counts~class+vote, data=sejong.poll.kr.2[region=="충청",], drop=T), col=color, main="", xlab="계급", ylab="찬반")
title(main="충청도의 찬반")
```

- 작업 디렉토리의 이미지와 히스토리를 저장하고 퇴장.

```
save.image(file="sejong_poll0328.rda")
savehistory(file="sejong_poll0328.Rhistory")
q("no")
```


